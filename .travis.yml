sudo: required

services:
  - docker

os:
  - linux
  - osx

language: rust

rust:
  - stable

matrix:
  allow_failures:
    - rust: nightly

cache: cargo

addons:
  apt:
    packages:
      - libgpgme11-dev=1.4.3-0.1ubuntu5.1
      - libgpg-error-dev=1.12-0.2ubuntu1

before_install:
  - | 
    if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
      brew install gpgme gettext
      brew link --force gettext
    fi


script:
  - cargo doc
  - cargo test --all
  # JourneyTests need docker, so it's OK to run them just on one OS. We also just need them once, as journey tests just use the MUSL binary
  - | 
    if [[ "$TRAVIS_OS_NAME" != "osx" && "$TRAVIS_RUST_VERSION" == "stable" ]]; then 
        make lint-scripts;
        make journey-tests;
    fi

env:
  global:
    - GPGME_DEBUG=9
    - AUTOMAKE_VERSION=1.14.1
    - GETTEXT_VERSION=0.19.3
