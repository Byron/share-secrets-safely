sudo: required

services:
  - docker

os:
  - linux
  - osx

language: rust

rust:
  - stable

matrix:
  allow_failures:
    - rust: nightly

cache: cargo

addons:
  apt:
    packages:
      - libgettextpo-dev

before_install:
  - | 
    if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
      brew install gpgme gettext
      brew link --force gettext
    fi


script:
  - cargo doc
  - cargo test --all
  # JourneyTests need docker, so it's OK to run them just on one OS. We also just need them once, as journey tests just use the MUSL binary
  - | 
    if [[ "$TRAVIS_OS_NAME" != "osx" && "$TRAVIS_RUST_VERSION" == "stable" ]]; then 
        make lint-scripts;
        make journey-tests;
    fi
